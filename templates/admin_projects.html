<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Projects | Admin</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
.edit-panel{display:none;margin-top:1rem;padding:1.2rem;border:1px solid var(--green);border-radius:6px;background:rgba(0,255,65,.03);}
.edit-panel.open{display:block;}
.project-row{border:1px solid var(--border);border-radius:8px;background:var(--bg-card);margin-bottom:1rem;overflow:hidden;transition:border-color .2s;}
.project-row:hover{border-color:rgba(0,255,65,.4);}
.project-row-header{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.2rem;gap:1rem;flex-wrap:wrap;}
.proj-row-info{display:flex;align-items:center;gap:1rem;flex:1;min-width:0;}
.proj-num{font-family:var(--font-display);font-size:1.4rem;font-weight:900;color:rgba(0,255,65,.25);flex-shrink:0;}
.proj-row-title{font-weight:700;color:white;font-size:.95rem;}
.proj-row-tags{font-family:var(--font-mono);font-size:.75rem;color:var(--text-dim);margin-top:.2rem;}
.proj-row-actions{display:flex;gap:.6rem;flex-shrink:0;}
.btn-edit-toggle{padding:.45rem 1rem;background:rgba(0,180,255,.1);border:1px solid rgba(0,180,255,.4);color:#00b4ff;border-radius:4px;font-family:var(--font-mono);font-size:.78rem;cursor:pointer;transition:all .2s;}
.btn-edit-toggle:hover{background:rgba(0,180,255,.2);}
.btn-edit-toggle.active{background:rgba(0,255,65,.1);border-color:var(--green);color:var(--green);}
.upload-zone{border:2px dashed var(--border);border-radius:6px;padding:1.2rem;text-align:center;cursor:pointer;transition:all .2s;background:rgba(0,255,65,.02);}
.upload-zone:hover{border-color:var(--green);background:rgba(0,255,65,.06);}
.upload-zone input[type=file]{display:none;}
.upload-label{display:flex;flex-direction:column;align-items:center;gap:.5rem;cursor:pointer;}
.upload-icon{font-size:2rem;color:var(--green);opacity:.6;}
.upload-text{font-family:var(--font-mono);font-size:.8rem;color:var(--text-dim);}
.upload-text span{color:var(--green);}
.thumb-preview{max-width:80px;max-height:60px;border-radius:4px;border:1px solid var(--border);object-fit:cover;margin-top:.5rem;}
</style>
</head>
<body class="admin-panel-body">
<div class="admin-layout">
  <aside class="admin-sidebar">
    <div class="sidebar-brand"><span class="bracket">[</span>ADMIN<span class="accent">_PANEL</span><span class="bracket">]</span></div>
    <nav class="sidebar-nav">
      <a href="/admin" class="sidebar-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="/admin/profile" class="sidebar-link"><i class="fas fa-user-circle"></i> Profile</a>
      <a href="/admin/projects" class="sidebar-link active"><i class="fas fa-code"></i> Projects</a>
      <a href="/admin/skills" class="sidebar-link"><i class="fas fa-tools"></i> Skills</a>
      <a href="/admin/experience" class="sidebar-link"><i class="fas fa-briefcase"></i> Experience</a>
      <a href="/admin/achievements" class="sidebar-link"><i class="fas fa-trophy"></i> Achievements</a>
      <a href="/admin/certifications" class="sidebar-link"><i class="fas fa-certificate"></i> Certifications</a>
      <a href="/admin/stats" class="sidebar-link"><i class="fas fa-chart-bar"></i> Stats</a>
      <a href="/admin/messages" class="sidebar-link"><i class="fas fa-envelope"></i> Messages</a>
      <div class="sidebar-divider"></div>
      <a href="/" class="sidebar-link" target="_blank"><i class="fas fa-external-link-alt"></i> View Portfolio</a>
      <a href="/admin/logout" class="sidebar-link logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </aside>
  <main class="admin-main">
    <div class="admin-topbar">
      <h1 class="admin-page-title"><i class="fas fa-code"></i> PROJECTS MANAGER</h1>
      <div class="admin-user"><span class="status-dot"></span> Abubakkar Siddiq</div>
    </div>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}" style="margin:1rem 2rem 0;">{{ message }}</div>
      {% endfor %}
    {% endwith %}

    <!-- ADD NEW -->
    <div class="admin-form-card">
      <h3 class="form-section-title">ADD NEW PROJECT</h3>
      <form method="POST" action="/admin/projects" enctype="multipart/form-data">
        <input type="hidden" name="action" value="add">
        <div class="form-grid-2">
          <div class="form-group form-full">
            <label class="form-label">Project Title *</label>
            <input type="text" name="title" class="form-input" placeholder="Project name" required>
          </div>
          <div class="form-group form-full">
            <label class="form-label">Description *</label>
            <textarea name="description" class="form-input form-textarea" rows="3" placeholder="What does this project do?" required></textarea>
          </div>
          <div class="form-group form-full">
            <label class="form-label">Highlights (one per line)</label>
            <textarea name="highlights" class="form-input form-textarea" rows="4" placeholder="Feature 1&#10;Feature 2&#10;Feature 3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Tags (comma separated)</label>
            <input type="text" name="tags" class="form-input" placeholder="Python, OWASP, Burp Suite">
          </div>
          <div class="form-group">
            <label class="form-label">Project Image</label>
            <div class="upload-zone" onclick="document.getElementById('add_proj_img').click()">
              <label class="upload-label">
                <span class="upload-icon">üñºÔ∏è</span>
                <span class="upload-text"><span>Click to upload</span> image<br>PNG, JPG, WEBP</span>
                <img id="add_proj_preview" class="thumb-preview" style="display:none;">
              </label>
              <input type="file" id="add_proj_img" name="image_file" accept="image/*"
                     onchange="previewImg(this,'add_proj_preview')">
            </div>
            <div style="margin-top:.4rem;">
              <label class="form-label" style="font-size:.75rem;">Or type filename:</label>
              <input type="text" name="image" class="form-input" placeholder="project4.jpg" style="margin-top:.3rem;">
            </div>
          </div>
          <div class="form-group form-full">
            <label class="form-label">Project Link / GitHub URL</label>
            <input type="text" name="link" class="form-input" placeholder="https://github.com/...">
          </div>
        </div>
        <button type="submit" class="btn-cyber btn-primary"><i class="fas fa-plus"></i> ADD PROJECT</button>
      </form>
    </div>

    <!-- EXISTING PROJECTS -->
    <div class="admin-form-card">
      <h3 class="form-section-title">EXISTING PROJECTS
        <span style="color:var(--text-dim);font-size:.8rem;font-weight:400;margin-left:.5rem;">
          {{ data.projects|length }} total ‚Äî click Edit to modify
        </span>
      </h3>

      {% for proj in data.projects %}
      <div class="project-row" id="proj-row-{{ loop.index0 }}">
        <div class="project-row-header">
          <div class="proj-row-info">
            <span class="proj-num">0{{ loop.index }}</span>
            <div>
              <div class="proj-row-title">{{ proj.title }}</div>
              <div class="proj-row-tags">{{ proj.tags | join(' ¬∑ ') }}</div>
            </div>
          </div>
          <div class="proj-row-actions">
            <button type="button" class="btn-edit-toggle" id="toggle-{{ loop.index0 }}"
                    onclick="toggleEdit({{ loop.index0 }})">
              <i class="fas fa-pen"></i> Edit
            </button>
            <form method="POST" action="/admin/projects" style="margin:0">
              <input type="hidden" name="action" value="delete">
              <input type="hidden" name="index" value="{{ loop.index0 }}">
              <button type="submit" class="btn-delete"
                      onclick="return confirm('Delete this project?')">
                <i class="fas fa-trash"></i>
              </button>
            </form>
          </div>
        </div>

        <div class="edit-panel" id="edit-{{ loop.index0 }}">
          <form method="POST" action="/admin/projects" enctype="multipart/form-data">
            <input type="hidden" name="action" value="edit">
            <input type="hidden" name="index" value="{{ loop.index0 }}">
            <div class="form-grid-2">
              <div class="form-group form-full">
                <label class="form-label">Title *</label>
                <input type="text" name="title" class="form-input" value="{{ proj.title }}" required>
              </div>
              <div class="form-group form-full">
                <label class="form-label">Description *</label>
                <textarea name="description" class="form-input form-textarea" rows="3" required>{{ proj.description }}</textarea>
              </div>
              <div class="form-group form-full">
                <label class="form-label">Highlights (one per line)</label>
                <textarea name="highlights" class="form-input form-textarea" rows="4">{{ proj.highlights | join('\n') }}</textarea>
              </div>
              <div class="form-group">
                <label class="form-label">Tags (comma separated)</label>
                <input type="text" name="tags" class="form-input" value="{{ proj.tags | join(', ') }}">
              </div>
              <div class="form-group">
                <label class="form-label">Project Image <small style="color:var(--text-dim)">(upload new or keep existing)</small></label>
                {% if proj.image %}
                <div style="margin-bottom:.5rem;display:flex;align-items:center;gap:.8rem;">
                  <img src="{{ url_for('static', filename='images/' + proj.image) }}"
                       style="max-width:70px;max-height:50px;border-radius:4px;border:1px solid var(--border);object-fit:cover;"
                       onerror="this.style.display='none'">
                  <span style="font-family:var(--font-mono);font-size:.75rem;color:var(--green)">{{ proj.image }}</span>
                </div>
                {% endif %}
                <div class="upload-zone" onclick="document.getElementById('edit_proj_img_{{ loop.index0 }}').click()">
                  <label class="upload-label">
                    <span class="upload-icon">üñºÔ∏è</span>
                    <span class="upload-text"><span>Click to upload new</span><br>PNG, JPG, WEBP</span>
                    <img id="edit_proj_preview_{{ loop.index0 }}" class="thumb-preview" style="display:none;">
                  </label>
                  <input type="file" id="edit_proj_img_{{ loop.index0 }}" name="image_file" accept="image/*"
                         onchange="previewImg(this,'edit_proj_preview_{{ loop.index0 }}')">
                </div>
                <input type="text" name="image" class="form-input" value="{{ proj.image }}" placeholder="project.jpg" style="margin-top:.4rem;">
              </div>
              <div class="form-group form-full">
                <label class="form-label">Project Link</label>
                <input type="text" name="link" class="form-input" value="{{ proj.link }}">
              </div>
            </div>
            <div style="display:flex;gap:.8rem;margin-top:.5rem;">
              <button type="submit" class="btn-cyber btn-primary" style="font-size:.85rem;">
                <i class="fas fa-save"></i> SAVE CHANGES
              </button>
              <button type="button" class="btn-cyber btn-outline" style="font-size:.85rem;"
                      onclick="toggleEdit({{ loop.index0 }})">Cancel</button>
            </div>
          </form>
        </div>
      </div>
      {% else %}
        <p style="color:var(--text-dim);font-family:var(--font-mono);font-size:.85rem;padding:1rem 0;">
          No projects yet. Add your first one above!
        </p>
      {% endfor %}
    </div>
  </main>
</div>
<script>
function toggleEdit(idx) {
  const panel = document.getElementById('edit-' + idx);
  const btn   = document.getElementById('toggle-' + idx);
  const open  = panel.classList.contains('open');
  document.querySelectorAll('.edit-panel').forEach(p => p.classList.remove('open'));
  document.querySelectorAll('.btn-edit-toggle').forEach(b => { b.classList.remove('active'); b.innerHTML = '<i class="fas fa-pen"></i> Edit'; });
  if (!open) {
    panel.classList.add('open');
    btn.classList.add('active');
    btn.innerHTML = '<i class="fas fa-times"></i> Close';
    panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
}
function previewImg(input, previewId) {
  const preview = document.getElementById(previewId);
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = e => { preview.src = e.target.result; preview.style.display = 'block'; };
    reader.readAsDataURL(input.files[0]);
  }
}
</script>
</body>
</html>
